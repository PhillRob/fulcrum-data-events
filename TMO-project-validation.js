// ON('validate-record', function (event) {
//   if (!PROJECTNAME()) {
//     INVALID('Please select a project before saving.');
//   }
// });
function pointInPolygon(polygon, point) {
    let odd = false;
    for (let i = 0, j = polygon.length - 1; i < polygon.length; i++) {
        if (((polygon[i][1] > point[1]) !== (polygon[j][1] > point[1])) 
            && (point[0] < ((polygon[j][0] - polygon[i][0]) * (point[1] - polygon[i][1]) / (polygon[j][1] - polygon[i][1]) + polygon[i][0]))) {
            odd = !odd;
        }
        j = i;
    }
    return odd;
};

const projects = [
{id:1, name: "DQ", poly:[[ 46.629715373195118, 24.694223188698089 ], [ 46.629802128234573, 24.694100354062101 ], [ 46.630152615949719, 24.693602205596445 ], [ 46.630501351667981, 24.693106332697155 ], [ 46.63120181947383, 24.692110037609737 ], [ 46.631902839898949, 24.691111476306013 ], [ 46.632568631274253, 24.690117719493653 ], [ 46.633056439585083, 24.68939017748465 ], [ 46.633235106419207, 24.68912413317641 ], [ 46.633592081937884, 24.688504104744212 ], [ 46.633810460740882, 24.688199163783963 ], [ 46.634447470365053, 24.687311894642253 ], [ 46.63471611552982, 24.686936429874269 ], [ 46.634777890829042, 24.68683878491764 ], [ 46.635723447198309, 24.685318372848275 ], [ 46.636802877993006, 24.683744578749891 ], [ 46.638071989473204, 24.681843661881654 ], [ 46.638273679042378, 24.681541244744491 ], [ 46.638461021806918, 24.681229954873842 ], [ 46.638633652130544, 24.680912053576346 ], [ 46.638790582064708, 24.680587551682375 ], [ 46.638931940027057, 24.680258705100453 ], [ 46.639065028603206, 24.679909633286773 ], [ 46.639180243385788, 24.679553984713326 ], [ 46.639276823607553, 24.679194024986998 ], [ 46.639354896561784, 24.678831919722469 ], [ 46.639413744817332, 24.67846569038139 ], [ 46.639453988508045, 24.678097406892707 ], [ 46.639466911624609, 24.677717954788331 ], [ 46.639457576092241, 24.677336578731015 ], [ 46.639424854351944, 24.676957715261242 ], [ 46.639369932220752, 24.676581351408807 ], [ 46.639319607931043, 24.676322315175575 ], [ 46.639285818166641, 24.676148874535226 ], [ 46.639178911468989, 24.67571890364912 ], [ 46.639050427454535, 24.675293682694193 ], [ 46.638861151854918, 24.674889440467442 ], [ 46.638656454568547, 24.674492138024295 ], [ 46.638437718884056, 24.674101760205115 ], [ 46.638204154499967, 24.673718315567143 ], [ 46.63799424680154, 24.673436189530978 ], [ 46.637767069514645, 24.673163280572432 ], [ 46.637524064815224, 24.672904087423163 ], [ 46.637194439670701, 24.672587149203228 ], [ 46.636850864929094, 24.672283905843326 ], [ 46.636493834553377, 24.671994351866786 ], [ 46.636164295157059, 24.671774472829625 ], [ 46.635826211153024, 24.671566062732619 ], [ 46.635479707184821, 24.671371106561885 ], [ 46.635125251258103, 24.671187612768819 ], [ 46.634566636429881, 24.670972481240657 ], [ 46.634001975690417, 24.67077095696207 ], [ 46.633432652025427, 24.670583024830254 ], [ 46.632858537079493, 24.670406428922313 ], [ 46.629973391015817, 24.669609349986267 ], [ 46.6270942390885, 24.668791833551545 ], [ 46.626359440504203, 24.66861243816415 ], [ 46.625630039921973, 24.668414832139408 ], [ 46.624905378831016, 24.668201550820267 ], [ 46.624187203057502, 24.667970047231112 ], [ 46.623475078517295, 24.667724930997032 ], [ 46.623298812550466, 24.667656860471197 ], [ 46.622721006890977, 24.667437376120965 ], [ 46.621973580204973, 24.66713620185422 ], [ 46.621234053814938, 24.666819137453977 ], [ 46.620539598795894, 24.666510612100321 ], [ 46.619851788909983, 24.66618846801498 ], [ 46.619171937790803, 24.665854948404359 ], [ 46.618499888533108, 24.665505540491239 ], [ 46.617836292319772, 24.665144751928104 ], [ 46.617269633662126, 24.664830319584937 ], [ 46.616710241745203, 24.664504520329778 ], [ 46.616159993725489, 24.66416733404191 ], [ 46.615617704188232, 24.663818773567254 ], [ 46.614424277677898, 24.663077670418691 ], [ 46.611502664749587, 24.661289665097048 ], [ 46.610110774690476, 24.660424155592679 ], [ 46.609873744463975, 24.660578024738065 ], [ 46.609193896961337, 24.660964533838907 ], [ 46.609076980640978, 24.661478191691184 ], [ 46.60895467461652, 24.66191064464191 ], [ 46.609192898766473, 24.662427270250504 ], [ 46.60934981636116, 24.66262874553917 ], [ 46.609760385856077, 24.663771050688787 ], [ 46.610006022298528, 24.66410249727425 ], [ 46.610196120486023, 24.664764103272812 ], [ 46.610497831292989, 24.664837616604164 ], [ 46.610604177450291, 24.665224730370461 ], [ 46.610962995070231, 24.665767146771461 ], [ 46.610762960721807, 24.665963419020059 ], [ 46.61050675943153, 24.666302502574535 ], [ 46.610713130651689, 24.667322842145612 ], [ 46.610907010030118, 24.667408797167489 ], [ 46.610841429120669, 24.667549452507576 ], [ 46.611008583588507, 24.667777903255967 ], [ 46.610875043257742, 24.66791251566594 ], [ 46.610936987564706, 24.668119521942028 ], [ 46.611051456094998, 24.668138609745338 ], [ 46.611250365032582, 24.668569785295308 ], [ 46.61087965858124, 24.669041111001704 ], [ 46.610933275435464, 24.669453619880176 ], [ 46.611248382409478, 24.669953615128236 ], [ 46.61220649154977, 24.670886879545531 ], [ 46.61241583111574, 24.671652109967365 ], [ 46.612992233588216, 24.671961940395413 ], [ 46.613736928716129, 24.672096149083519 ], [ 46.613672929030571, 24.672351910175614 ], [ 46.61272060498667, 24.67259238348613 ], [ 46.61258725412474, 24.673510274078279 ], [ 46.612903708586963, 24.674098284631761 ], [ 46.614209636259012, 24.67432126728902 ], [ 46.615394388682716, 24.67415051714174 ], [ 46.620017358080219, 24.67422486544698 ], [ 46.620301709378168, 24.674573933400922 ], [ 46.618961002206994, 24.675346840672578 ], [ 46.615883896070549, 24.675468019116433 ], [ 46.614027318164162, 24.67589429775342 ], [ 46.612851619290886, 24.676055911419539 ], [ 46.611598470365124, 24.67581203559029 ], [ 46.611517771412537, 24.675876105720132 ], [ 46.611615847657475, 24.676103039116946 ], [ 46.611652419988637, 24.677364469922644 ], [ 46.611882813698472, 24.677845056114172 ], [ 46.612292531458053, 24.6783462892285 ], [ 46.612265050743005, 24.678468477754762 ], [ 46.612035051431718, 24.678595098022921 ], [ 46.61177871390607, 24.678925156445427 ], [ 46.612043207351519, 24.67922930780545 ], [ 46.611840994022252, 24.680026043399518 ], [ 46.611845521582211, 24.680378131366197 ], [ 46.612186064999904, 24.680586659826542 ], [ 46.612162444733393, 24.68100902581676 ], [ 46.611914851596744, 24.681250956531674 ], [ 46.611763465529236, 24.681489596780157 ], [ 46.611757236929371, 24.681719906757994 ], [ 46.611873430599545, 24.681872154705729 ], [ 46.611943889898967, 24.682740452961884 ], [ 46.612098262156984, 24.683555932435791 ], [ 46.612179664637921, 24.683830446989454 ], [ 46.612328692522901, 24.684138094448429 ], [ 46.61264019766891, 24.68434693321106 ], [ 46.612989460491811, 24.684510219915762 ], [ 46.61321141876725, 24.684525893150344 ], [ 46.613425571011362, 24.684656771401496 ], [ 46.614115962622357, 24.684313104882364 ], [ 46.614328864045483, 24.684346841822791 ], [ 46.614382420494508, 24.684768377750743 ], [ 46.614300062434644, 24.685087540260735 ], [ 46.61385724841108, 24.685180335483437 ], [ 46.613512707700615, 24.685430082990433 ], [ 46.613137680842151, 24.685461200882344 ], [ 46.613128357552924, 24.685558364252564 ], [ 46.614042208897395, 24.686067625981824 ], [ 46.61471995162551, 24.686229723672184 ], [ 46.615673055451012, 24.686808618726477 ], [ 46.615785988482727, 24.686753228407113 ], [ 46.616818894743126, 24.686286135982797 ], [ 46.616871762038159, 24.68622461998158 ], [ 46.61687992481923, 24.686091352515128 ], [ 46.616752147964334, 24.685907631755047 ], [ 46.616729991243218, 24.685668598640078 ], [ 46.617101398504388, 24.685303433263151 ], [ 46.617283884565353, 24.685231491659849 ], [ 46.617381941652148, 24.685363614743476 ], [ 46.617289011058432, 24.685628717764178 ], [ 46.617478063505985, 24.686057821343798 ], [ 46.617671743678606, 24.686125709972998 ], [ 46.618268110604539, 24.685970301656283 ], [ 46.618702278219807, 24.685965620559475 ], [ 46.618894546285951, 24.685893571518509 ], [ 46.619117276748248, 24.685961144965599 ], [ 46.619698157832097, 24.685945849353917 ], [ 46.619753437291571, 24.685918165546116 ], [ 46.619813103474762, 24.685274197372806 ], [ 46.619982526708569, 24.68495635015196 ], [ 46.619901827336356, 24.684684090284286 ], [ 46.620017334020567, 24.684682843830117 ], [ 46.620084457847533, 24.684761124189915 ], [ 46.620204808162356, 24.684996929832231 ], [ 46.620218101907831, 24.685260797618255 ], [ 46.620278728869692, 24.685463298286777 ], [ 46.620395841364818, 24.685586184470761 ], [ 46.620470424077162, 24.685576350265912 ], [ 46.620747233038884, 24.685148993663816 ], [ 46.620865478040713, 24.684549538341486 ], [ 46.621052492261441, 24.684445941496559 ], [ 46.62142104491835, 24.684243320838831 ], [ 46.621576970717662, 24.684356757788969 ], [ 46.621647442159045, 24.684602039785506 ], [ 46.621121829052385, 24.684977910294673 ], [ 46.620952339147799, 24.68529801668344 ], [ 46.620993088780345, 24.685491702538418 ], [ 46.620815275432065, 24.685924762554414 ], [ 46.620501762174889, 24.686280282654234 ], [ 46.620098122711312, 24.68644490626486 ], [ 46.620080996238919, 24.686603100562351 ], [ 46.620183007144313, 24.686796125458272 ], [ 46.619758922169282, 24.686816503106439 ], [ 46.619250392024604, 24.686894222469604 ], [ 46.618547953642334, 24.687077865908588 ], [ 46.618077154009526, 24.68743733442945 ], [ 46.617745578308032, 24.68769598086298 ], [ 46.617110734223758, 24.687987238740245 ], [ 46.617026052544851, 24.688164218836349 ], [ 46.617141281556357, 24.688485768443634 ], [ 46.617537785794475, 24.689298631191935 ], [ 46.617886927527472, 24.689741809440637 ], [ 46.618291227309555, 24.690055727195162 ], [ 46.617806938957976, 24.692065411108146 ], [ 46.618127440928362, 24.692249310066959 ], [ 46.61984485441652, 24.693226243004897 ], [ 46.626714754740206, 24.696752194347269 ], [ 46.627693672559502, 24.697215696460205 ], [ 46.629591022436045, 24.694396091441593 ], [ 46.629715373195118, 24.694223188698089 ]]},
{id:2, name: "KKSR", poly:[[ 46.596829544593412, 24.728819172245263 ], [ 46.597417867175679, 24.728327415109401 ], [ 46.597596526378787, 24.728194525904776 ], [ 46.597979210886223, 24.727878039852815 ], [ 46.599670729407208, 24.726565128952917 ], [ 46.600277411356927, 24.726082878055259 ], [ 46.601306805755243, 24.725229700321353 ], [ 46.601619106910867, 24.725042186943636 ], [ 46.60234642781483, 24.724436597465335 ], [ 46.602693361828493, 24.724219927048704 ], [ 46.602790803312999, 24.723939445274045 ], [ 46.6034583955133, 24.723342675935779 ], [ 46.604982396185079, 24.721849985406635 ], [ 46.607449367963731, 24.719895503573543 ], [ 46.615559232407165, 24.713220166854057 ], [ 46.618042445503676, 24.711136557145874 ], [ 46.619202324955033, 24.70993316124385 ], [ 46.619259273120733, 24.709862368882792 ], [ 46.619913032645719, 24.70916219660252 ], [ 46.620302993269597, 24.708648497500089 ], [ 46.620698340136848, 24.708072471151759 ], [ 46.62100213708618, 24.707604989337508 ], [ 46.621543250839437, 24.706800947370258 ], [ 46.622465429454451, 24.70575502209558 ], [ 46.622990287353829, 24.705132299753359 ], [ 46.623327083176953, 24.704719584624652 ], [ 46.623361770649517, 24.704687831453196 ], [ 46.623403143021058, 24.704663666205388 ], [ 46.623497918372401, 24.70464225478986 ], [ 46.623591006615122, 24.704658272637829 ], [ 46.623686065251412, 24.704718916967323 ], [ 46.624024932713994, 24.704428915571246 ], [ 46.623774474108338, 24.704102431025991 ], [ 46.623760607193205, 24.704067215128347 ], [ 46.623768220938977, 24.704020446995305 ], [ 46.624273124631067, 24.703233040385989 ], [ 46.624979893205278, 24.702042606734974 ], [ 46.62548203369699, 24.701265055469122 ], [ 46.627294776853716, 24.698573831240605 ], [ 46.628858672944091, 24.696272789144594 ], [ 46.628988173028901, 24.69611596790881 ], [ 46.629122994114468, 24.695974061708196 ], [ 46.629265410919302, 24.695847117160969 ], [ 46.629438830814259, 24.69571275345621 ], [ 46.629667730018312, 24.695566647931969 ], [ 46.629907798126617, 24.695445657008449 ], [ 46.630115276836719, 24.695365615302464 ], [ 46.630291589241395, 24.695311311564257 ], [ 46.630558687085497, 24.695254770702878 ], [ 46.630807635904191, 24.695227859542719 ], [ 46.631058270578009, 24.695223257618427 ], [ 46.631173936874838, 24.69523038210265 ], [ 46.631426377685131, 24.69526042340015 ], [ 46.631697156691956, 24.695314607223214 ], [ 46.632176726520257, 24.695467286832908 ], [ 46.632762299974758, 24.695707183442465 ], [ 46.633005004812887, 24.695195567422434 ], [ 46.632179705158393, 24.69484581590303 ], [ 46.631994300438834, 24.694748443990864 ], [ 46.631808660722257, 24.694632860067529 ], [ 46.631687531782241, 24.69453796344753 ], [ 46.631506190051041, 24.69435593447632 ], [ 46.631414219730971, 24.694236953412361 ], [ 46.63128985386917, 24.694044466690215 ], [ 46.631230326237002, 24.693885545814535 ], [ 46.63117958922242, 24.693719464118015 ], [ 46.631147093511849, 24.693536866811026 ], [ 46.631139909537943, 24.693341345569621 ], [ 46.6311596338386, 24.6931469097002 ], [ 46.631236248886921, 24.69286849464299 ], [ 46.631353148684767, 24.692612005755716 ], [ 46.6315164716802, 24.69235258963678 ], [ 46.631940076828649, 24.691715855748662 ], [ 46.633564264236348, 24.689306405482398 ], [ 46.634044412679977, 24.688619746777526 ], [ 46.634518134872231, 24.688058573024353 ], [ 46.634828446777263, 24.687745728875669 ], [ 46.635049115441241, 24.68754846015867 ], [ 46.635327269996381, 24.687324008595482 ], [ 46.638615539601773, 24.685046646621231 ], [ 46.638365310211768, 24.684604501121836 ], [ 46.63828322219819, 24.68465044205055 ], [ 46.638152909367271, 24.684694115615077 ], [ 46.63806802175602, 24.684710583647789 ], [ 46.63794710631452, 24.684721037730679 ], [ 46.637808615661207, 24.684712526525807 ], [ 46.637736732753012, 24.684699042161505 ], [ 46.637632900257543, 24.684665994534743 ], [ 46.637534768607267, 24.684620680072687 ], [ 46.637418114848323, 24.684539582277949 ], [ 46.637321319801572, 24.684439006102963 ], [ 46.63728172678389, 24.684375064382166 ], [ 46.637242675195679, 24.684283880595888 ], [ 46.63722111882511, 24.684171359036945 ], [ 46.63722550821727, 24.684057198338866 ], [ 46.637237417794097, 24.684001049474745 ], [ 46.63726690042094, 24.683930663350374 ], [ 46.637313659985821, 24.683861121710478 ], [ 46.636629760151088, 24.683589699660416 ], [ 46.635755652005898, 24.684886071035052 ], [ 46.635482563036227, 24.685200550050066 ], [ 46.635172726598967, 24.685418003534362 ], [ 46.634946543583219, 24.685517800460843 ], [ 46.634663303448463, 24.685592306800999 ], [ 46.634110595323172, 24.685721569506395 ], [ 46.633820746249199, 24.685835059699844 ], [ 46.633510555369973, 24.686033102185394 ], [ 46.633236964133353, 24.68630216576172 ], [ 46.632977755341557, 24.686590485810903 ], [ 46.632776931426768, 24.68676385968908 ], [ 46.63262453728624, 24.686839015685933 ], [ 46.632391294736223, 24.686890580200142 ], [ 46.632091925427623, 24.686872798699483 ], [ 46.631959622469772, 24.686841271130284 ], [ 46.631778589314507, 24.687297189219048 ], [ 46.631832145083415, 24.687322561063301 ], [ 46.63207580951984, 24.687539950287171 ], [ 46.632435423977903, 24.688070471094679 ], [ 46.632559253904063, 24.688328529371724 ], [ 46.63266701517567, 24.688673171355898 ], [ 46.632703655066436, 24.68884567939293 ], [ 46.63271644930645, 24.689167787524905 ], [ 46.63268441731897, 24.689348897823731 ], [ 46.632601016207538, 24.68955422483004 ], [ 46.632289400905123, 24.690068477585104 ], [ 46.629621779648048, 24.693972291356609 ], [ 46.629562214627441, 24.694012487271994 ], [ 46.628615655228529, 24.694006781849836 ], [ 46.628290103721262, 24.694112520791265 ], [ 46.627999649658108, 24.694265014584506 ], [ 46.627770296222828, 24.69449539805386 ], [ 46.627603461800007, 24.694890243096445 ], [ 46.627585660630793, 24.695345681097656 ], [ 46.627718646760492, 24.695935642909841 ], [ 46.627703246607588, 24.696355482981684 ], [ 46.627635481591348, 24.696559019960297 ], [ 46.6261611248528, 24.698736260169628 ], [ 46.625999685420929, 24.699037233123668 ], [ 46.625781885489083, 24.699359132010699 ], [ 46.625666070240989, 24.699515094571026 ], [ 46.623153718046133, 24.70310304548773 ], [ 46.623093673629732, 24.703165230940115 ], [ 46.623056559345827, 24.70318930488007 ], [ 46.622998509333897, 24.703212982280863 ], [ 46.622927537699518, 24.703227072410595 ], [ 46.622882019102477, 24.703227186466112 ], [ 46.622793593609693, 24.703208460437221 ], [ 46.622737842242273, 24.703180490929832 ], [ 46.622682699899237, 24.70313735770036 ], [ 46.622263946133138, 24.703445686658835 ], [ 46.622646992606761, 24.703856258937435 ], [ 46.622259327940377, 24.70443846119592 ], [ 46.621914590408402, 24.704974460780036 ], [ 46.621792500875038, 24.70511919129417 ], [ 46.620550185680337, 24.707001792684675 ], [ 46.62043258645469, 24.707147480434589 ], [ 46.619843482458457, 24.708016558730172 ], [ 46.619136063013897, 24.708962064714441 ], [ 46.619001736058657, 24.709105275645413 ], [ 46.618365708678347, 24.709839622046406 ], [ 46.617883458459488, 24.710295820638173 ], [ 46.617501938932449, 24.710678656496487 ], [ 46.617036345479207, 24.711110921943671 ], [ 46.616777590998453, 24.711334293578247 ], [ 46.615777013693467, 24.712143469650698 ], [ 46.614732556403219, 24.713026811834272 ], [ 46.612299867942923, 24.714997867828977 ], [ 46.611712544864119, 24.715441645572213 ], [ 46.60967312479471, 24.717093533593406 ], [ 46.608167609603044, 24.718334467633614 ], [ 46.604461769553453, 24.721321569056553 ], [ 46.603410288909217, 24.72217810079551 ], [ 46.603282026435835, 24.72229973372216 ], [ 46.602911169048703, 24.722591746246799 ], [ 46.602795696081927, 24.722693156804123 ], [ 46.601975796181335, 24.723321027881077 ], [ 46.601264113873924, 24.723923887789866 ], [ 46.600501613803203, 24.724551007399928 ], [ 46.59897459326293, 24.725776743325735 ], [ 46.59845583567045, 24.72621670829718 ], [ 46.598383120592658, 24.726146848682841 ], [ 46.598162721055019, 24.726309342289721 ], [ 46.598233759607638, 24.726381683929965 ], [ 46.596356191250351, 24.727902383716994 ], [ 46.595679599825381, 24.72846156589965 ], [ 46.595022670066548, 24.729034854438204 ], [ 46.594381044386843, 24.729639696870549 ], [ 46.593893046164951, 24.730143501748579 ], [ 46.593367070823497, 24.730730984501669 ], [ 46.592922462824077, 24.731269647254198 ], [ 46.592307929475609, 24.732066748922062 ], [ 46.592019451359619, 24.732414287002776 ], [ 46.592896543319718, 24.733005516906967 ], [ 46.593012696591963, 24.732769124283589 ], [ 46.593475035398328, 24.732107160496152 ], [ 46.594317064307738, 24.731126885413136 ], [ 46.594527861429803, 24.73093099387048 ], [ 46.595203180095183, 24.730273172202306 ], [ 46.596492162017711, 24.729101139655622 ], [ 46.596829544593412, 24.728819172245263 ] ]}
];

  var res= [];
  var results = [];
  
function validateLocation(lat,lng, projectname) {
  projects.forEach((item,index) => {
    // console.log(item.name);
    var res = pointInPolygon(item.poly, [lng,lat])
    if (AND(res === true, item.name !== projectname)){
      const greeting = `The tree location is in ${item.name}, but your project is set to ${projectname}.`;
      INVALID(greeting)
    }
    // }
    // console.log(projectname);
    results.push(res)

  });
  
  const isArrayWithEqualEntries = results => new Set(results).size === 1
  if (isArrayWithEqualEntries(results) === true) {
      ALERT('your location is outside all projects')
    }
};

ON('validate-record', function (event) {
  var lat = LATITUDE();
  var lng = LONGITUDE();

  const projectname = PROJECTNAME()
  validateLocation(lat,lng, projectname)
// 24.682035, 46.630064
});

var res= [];
var results = [];

// ON('new-record', function (event) {
//   var lat = LATITUDE();
//   var lng = LONGITUDE();
//   const projectname = PROJECTNAME()
//   validateLocation(lat,lng, projectname)
// });

var res= [];
var results = [];

ON('load-record', function (event) {
  var lat = LATITUDE();
  var lng = LONGITUDE();
  const projectname = PROJECTNAME()
  validateLocation(lat,lng, projectname)
// 24.682035, 46.630064

});